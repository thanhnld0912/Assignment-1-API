@{
    ViewData["Title"] = "Create Category";
}

<h2>Create New Category</h2>

<form id="create-category-form">
    <div>
        <label>Name</label>
        <input name="categoryName" required />
    </div>
    <div>
        <label>Description</label>
        <input name="categoryDesciption" required />
    </div>
    <div>
        <label>Parent Category</label>
        <select name="parentCategoryId" id="parentCategoryId">
            <option value="">-- None --</option>
        </select>
    </div>
    <div>
        <label>Active</label>
        <input type="checkbox" name="isActive" checked />
    </div>
    <button type="submit">Create</button>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Load parent category options
            $.get("https://localhost:7123/odata/Categories", function (response) {
                const options = response.value;
                const dropdown = $("#parentCategoryId");

                options.forEach(function (cat) {
                    dropdown.append(`<option value="${cat.CategoryId}">${cat.CategoryName}</option>`);
                });
            });
            // Form submission
            $("#create-category-form").on("submit", function (e) {
                e.preventDefault();

                const data = {
                    categoryName: $("input[name=categoryName]").val(),
                    categoryDesciption: $("input[name=categoryDesciption]").val(),
                    parentCategoryId: parseInt($("#parentCategoryId").val()) || null,
                    isActive: $("input[name=isActive]").is(":checked")
                };

                $.ajax({
                    url: "https://localhost:7123/odata/Categories",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(data),
                    success: function () {
                        alert("Category created successfully.");
                        window.location.href = "/Category/Index";
                    },
                    error: function (xhr) {
                        alert("Create failed: " + xhr.responseText);
                    }
                });
            });
        });
    </script>
}
